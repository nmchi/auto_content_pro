    # === TAB CÃ€I Äáº¶T ===
    with tab_settings:
        st.subheader("âš™ï¸ CÃ i Ä‘áº·t nÃ¢ng cao")
        
        # === CUSTOM ROLES ===
        st.markdown("### ğŸ‘¤ Quáº£n lÃ½ Vai trÃ²")
        st.markdown("""
        TÃ¹y chá»‰nh vai trÃ² cho tá»«ng danh má»¥c Ä‘á»ƒ AI hiá»ƒu rÃµ hÆ¡n vá» ná»™i dung cáº§n viáº¿t.
        - **Vai trÃ² máº·c Ä‘á»‹nh**: DÃ¹ng cho táº¥t cáº£ danh má»¥c chÆ°a cÃ³ vai trÃ² riÃªng
        - **Vai trÃ² tÃ¹y chá»‰nh**: Táº¡o riÃªng cho tá»«ng danh má»¥c quan trá»ng
        """)
        
        # Default role
        with st.expander("ğŸ“Œ Vai trÃ² máº·c Ä‘á»‹nh", expanded=False):
            st.text_area(
                "Vai trÃ² máº·c Ä‘á»‹nh (Ã¡p dá»¥ng cho táº¥t cáº£ danh má»¥c):",
                value=DEFAULT_ROLE,
                height=100,
                disabled=True,
                help="ÄÃ¢y lÃ  vai trÃ² máº·c Ä‘á»‹nh, khÃ´ng thá»ƒ chá»‰nh sá»­a"
            )
        
        # Custom roles per category
        st.markdown("**Vai trÃ² tÃ¹y chá»‰nh theo danh má»¥c:**")
        
        if st.session_state.get('wp_categories'):
            # Select category to customize
            col1, col2 = st.columns([2, 1])
            
            with col1:
                selected_cat = st.selectbox(
                    "Chá»n danh má»¥c Ä‘á»ƒ tÃ¹y chá»‰nh vai trÃ²:",
                    list(st.session_state['wp_categories'].keys()),
                    key="role_cat_select"
                )
            
            with col2:
                has_custom = selected_cat in st.session_state['category_roles']
                status = "âœ… CÃ³ vai trÃ² riÃªng" if has_custom else "ğŸ“ DÃ¹ng máº·c Ä‘á»‹nh"
                st.metric("Tráº¡ng thÃ¡i", status)
            
            # Edit role
            current_role = st.session_state['category_roles'].get(selected_cat, DEFAULT_ROLE)
            
            edited_role = st.text_area(
                f"Vai trÃ² cho danh má»¥c '{selected_cat}':",
                value=current_role,
                height=150,
                key=f"role_editor_{selected_cat}",
                help="MÃ´ táº£ vai trÃ² cá»§a AI khi viáº¿t bÃ i cho danh má»¥c nÃ y"
            )
            
            col_a, col_b, col_c = st.columns(3)
            
            with col_a:
                if st.button("ğŸ’¾ LÆ°u vai trÃ²", use_container_width=True, type="primary"):
                    st.session_state['category_roles'][selected_cat] = edited_role
                    st.success(f"âœ… ÄÃ£ lÆ°u vai trÃ² cho '{selected_cat}'!")
                    st.rerun()
            
            with col_b:
                if st.button("ğŸ”„ Reset vá» máº·c Ä‘á»‹nh", use_container_width=True):
                    if selected_cat in st.session_state['category_roles']:
                        del st.session_state['category_roles'][selected_cat]
                        st.success(f"âœ… ÄÃ£ reset vai trÃ² cho '{selected_cat}'!")
                        st.rerun()
            
            with col_c:
                if st.button("ğŸ¤– Nhá» AI táº¡o", use_container_width=True):
                    if not gemini_key:
                        st.error("Thiáº¿u Gemini API Key!")
                    else:
                        with st.spinner("AI Ä‘ang táº¡o vai trÃ²..."):
                            try:
                                client = genai.Client(api_key=gemini_key)
                                
                                prompt = f"""
Táº¡o vai trÃ² (role description) cho AI viáº¿t bÃ i trong danh má»¥c "{selected_cat}".

Vai trÃ² nÃªn:
- Báº¯t Ä‘áº§u báº±ng "Vá»›i tÆ° cÃ¡ch lÃ ..."
- MÃ´ táº£ chuyÃªn mÃ´n, kiáº¿n thá»©c liÃªn quan Ä‘áº¿n "{selected_cat}"
- Ngáº¯n gá»n, 1-2 cÃ¢u
- Tiáº¿ng Viá»‡t

VÃ­ dá»¥: "Vá»›i tÆ° cÃ¡ch lÃ  chuyÃªn gia vá» manga Nháº­t Báº£n, báº¡n am hiá»ƒu vÄƒn hÃ³a otaku vÃ  xu hÆ°á»›ng manga hiá»‡n táº¡i."

Chá»‰ tráº£ vá» vai trÃ², khÃ´ng giáº£i thÃ­ch.
"""
                                
                                from google.genai import types
                                response = client.models.generate_content(
                                    model="gemini-2.5-flash",
                                    contents=prompt,
                                    config=types.GenerateContentConfig(
                                        temperature=0.7,
                                        max_output_tokens=200,
                                    )
                                )
                                
                                generated_role = response.text.strip()
                                st.session_state['category_roles'][selected_cat] = generated_role
                                st.success(f"âœ… AI Ä‘Ã£ táº¡o vai trÃ² cho '{selected_cat}'!")
                                st.rerun()
                                
                            except Exception as e:
                                st.error(f"Lá»—i: {e}")
            
            # Show all custom roles
            if st.session_state['category_roles']:
                with st.expander(f"ğŸ“‹ Táº¥t cáº£ vai trÃ² tÃ¹y chá»‰nh ({len(st.session_state['category_roles'])})"):
                    for cat, role in st.session_state['category_roles'].items():
                        st.markdown(f"**{cat}:**")
                        st.caption(role)
                        st.markdown("---")
        else:
            st.info("ğŸ‘‹ HÃ£y káº¿t ná»‘i WordPress Ä‘á»ƒ quáº£n lÃ½ vai trÃ² theo danh má»¥c.")
        
        st.markdown("---")
        st.markdown("### XÃ³a dá»¯ liá»‡u")
        
        col_x, col_y = st.columns(2)
        
        with col_x:
            if st.button("ğŸ—‘ï¸ XÃ³a táº¥t cáº£ Prompt", type="secondary", use_container_width=True):
                st.session_state['cat_prompts'] = {}
                st.success("ÄÃ£ xÃ³a táº¥t cáº£ prompt!")
                st.rerun()
        
        with col_y:
            if st.button("ğŸ—‘ï¸ XÃ³a táº¥t cáº£ Vai trÃ²", type="secondary", use_container_width=True):
                st.session_state['category_roles'] = {}
                st.success("ÄÃ£ xÃ³a táº¥t cáº£ vai trÃ² tÃ¹y chá»‰nh!")
                st.rerun()
